<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scan2Print Dashboard</title>
<style>
body { font-family: Arial; background:#f4f7f6; padding:20px; }
h2 { margin-bottom:10px; }
table { width:100%; background:#fff; border-collapse:collapse; }
th, td { padding:12px; border-bottom:1px solid #ddd; }
th { background:#2d7ff9; color:#fff; }
button { padding:6px 12px; cursor:pointer; }
.done { color:gray; text-decoration:line-through; }
</style>
</head>
<body>

<h2 id="title">Dashboard</h2>

<table>
<thead>
<tr>
  <th>Time</th>
  <th>File</th>
  <th>Status</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGyVFj84IlyIyw0kyoNmcSARmDw3IVVGluIawmz69dXEja1tXEszMXH7wDkfn47mmPlQ/exec";
const BOT_TOKEN = "8218702839:AAFYe9BDwUxyo9Ce1ZoIfBOb7nnLfQzJTv0";
const shop = new URLSearchParams(location.search).get("shop");

document.getElementById("title").innerText = "Shop: " + shop;

async function load() {
  const res = await fetch(`${SCRIPT_URL}?shop=${shop}`);
  const data = await res.json();

  let html = "";
  data.forEach(f => {
    const isDone = f.status === "DELETED";
    html += `
      <tr>
        <td>${new Date(f.time).toLocaleString()}</td>
        <td class="${isDone ? 'done' : ''}">${f.fileName}</td>
        <td>${f.status}</td>
        <td>
          ${isDone ? "-" : `
            <button onclick="download('${f.fileId}')">Download</button>
            <button onclick="done('${f.fileId}')">Done</button>
          `}
        </td>
      </tr>
    `;
  });

  document.getElementById("list").innerHTML = html;
}

function download(fileId) {
  window.open(`https://api.telegram.org/file/bot${BOT_TOKEN}/${fileId}`, "_blank");
}

async function done(fileId) {
  await fetch(`${SCRIPT_URL}?action=done&fileId=${fileId}`);
  load();
}

load();
setInterval(load, 20000);
</script>

</body>
</html>
