<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scan2Print Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial;
  background:#f4f7f6;
  padding:18px;
  margin:0;
}

/* Top bar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

.brand{
  display:flex;
  align-items:center;
  gap:14px;
}

.logo{
  width:88px; /* 2Ã— logo */
  height:auto;
}

h2{
  margin:0;
  font-size:20px;
}

.muted{
  color:#78909c;
  font-size:13px;
}

/* Controls */
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

select,button{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #cfd8dc;
  font-size:14px;
}

button{
  background:#2d7ff9;
  color:#fff;
  border:none;
  cursor:pointer;
}

/* ðŸ”¥ BIG STATISTICS SECTION (3Ã— PRESENCE) */
.kpis{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:18px;
  margin-top:30px;
  margin-bottom:140px; /* pushes table to middle */
}

.kpi{
  background:#fff;
  padding:28px;
  border-radius:22px;
  border:1px solid #e6ecef;
  text-align:center;
}

.kpi .label{
  font-size:18px;
  color:#607d8b;
}

.kpi .value{
  font-size:56px;      /* ðŸ”¥ BIG NUMBERS */
  font-weight:800;
  margin-top:10px;
  color:#263238;
}

/* Table */
.tableWrap{
  margin-top:40px;
}

table{
  width:100%;
  background:#fff;
  border-collapse:collapse;
  border-radius:18px;
  overflow:hidden;
}

th,td{
  padding:14px;
  border-bottom:1px solid #eee;
  font-size:14px;
}

th{
  background:#2d7ff9;
  color:#fff;
  text-align:left;
}

.done{
  color:gray;
  text-decoration:line-through;
}

.actions button{
  margin-right:6px;
  margin-bottom:6px;
}

/* Mobile */
@media(max-width:800px){
  .kpis{
    grid-template-columns:1fr;
    margin-bottom:80px;
  }
  .kpi .value{
    font-size:44px;
  }
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="brand">
    <img src="logo.png" class="logo">
    <div>
      <h2 id="title"></h2>
      <div class="muted">Upload monitoring dashboard</div>
    </div>
  </div>

  <div class="controls">
    <select id="period">
      <option value="today">Today</option>
      <option value="week">Week</option>
      <option value="month">Month</option>
    </select>

    <select id="status">
      <option value="ACTIVE">Active</option>
      <option value="DELETED">Deleted</option>
      <option value="ALL">All</option>
    </select>

    <button onclick="load()">Refresh</button>
  </div>
</div>

<!-- BIG STATS -->
<div class="kpis">
  <div class="kpi">
    <div class="label">Uploads Today</div>
    <div class="value" id="kToday">0</div>
  </div>
  <div class="kpi">
    <div class="label">This Week</div>
    <div class="value" id="kWeek">0</div>
  </div>
  <div class="kpi">
    <div class="label">This Month</div>
    <div class="value" id="kMonth">0</div>
  </div>
</div>

<!-- TABLE -->
<div class="tableWrap">
<table>
<thead>
<tr>
  <th>Time</th>
  <th>File</th>
  <th>Status</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGyVFj84IlyIyw0kyoNmcSARmDw3IVVGluIawmz69dXEja1tXEszMXH7wDkfn47mmPlQ/exec";
const shop = new URLSearchParams(location.search).get("shop") || "General";
document.getElementById("title").innerText = "Shop: " + shop;

async function load(){
  const res = await fetch(`${SCRIPT_URL}?shop=${shop}&period=${period.value}&status=${status.value}`);
  const d = await res.json();

  kToday.innerText = d.summary.today;
  kWeek.innerText  = d.summary.week;
  kMonth.innerText = d.summary.month;

  list.innerHTML = d.files.map(f=>`
    <tr>
      <td>${new Date(f.time).toLocaleString()}</td>
      <td class="${f.status==='DELETED'?'done':''}">${f.fileName}</td>
      <td>${f.status}</td>
      <td class="actions">
        ${f.status==='ACTIVE'
          ? `<button onclick="window.open('${f.fileUrl}')">Download</button>
             <button onclick="done('${f.fileId}')">Done</button>`
          : '-'}
      </td>
    </tr>
  `).join("");
}

async function done(id){
  await fetch(`${SCRIPT_URL}?action=done&fileId=${id}`);
  load();
}

load();
</script>

</body>
</html>
