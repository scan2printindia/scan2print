<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scan2Print Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f7f6;padding:18px;margin:0}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:88px;height:auto}
h2{margin:0;font-size:18px}
.muted{color:#78909c;font-size:12px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
select,button{padding:8px 10px;border-radius:10px;border:1px solid #cfd8dc}
button{background:#2d7ff9;color:#fff;border:none;cursor:pointer}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0}
.kpi{background:#fff;padding:12px;border-radius:14px;border:1px solid #e6ecef}
.value{font-size:22px;font-weight:800}
table{width:100%;background:#fff;border-collapse:collapse;border-radius:14px;overflow:hidden}
th,td{padding:12px;border-bottom:1px solid #eee}
th{background:#2d7ff9;color:#fff;text-align:left}
.done{color:gray;text-decoration:line-through}
.actions button{margin-right:6px}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">
    <img src="logo.png" class="logo">
    <div>
      <h2 id="title"></h2>
      <div class="muted">Manage uploads</div>
    </div>
  </div>
  <div class="controls">
    <select id="period">
      <option value="today">Today</option>
      <option value="week">Week</option>
      <option value="month">Month</option>
    </select>
    <select id="status">
      <option value="ACTIVE">Active</option>
      <option value="DELETED">Deleted</option>
      <option value="ALL">All</option>
    </select>
    <button onclick="load()">Refresh</button>
  </div>
</div>

<div class="kpis">
  <div class="kpi"><div>Today</div><div class="value" id="kToday">0</div></div>
  <div class="kpi"><div>Week</div><div class="value" id="kWeek">0</div></div>
  <div class="kpi"><div>Month</div><div class="value" id="kMonth">0</div></div>
</div>

<table>
<thead>
<tr><th>Time</th><th>File</th><th>Status</th><th>Action</th></tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwGyVFj84IlyIyw0kyoNmcSARmDw3IVVGluIawmz69dXEja1tXEszMXH7wDkfn47mmPlQ/exec";
const shop=new URLSearchParams(location.search).get("shop")||"General";
document.getElementById("title").innerText="Shop: "+shop;

async function load(){
  const res=await fetch(`${SCRIPT_URL}?shop=${shop}&period=${period.value}&status=${status.value}`);
  const d=await res.json();
  kToday.innerText=d.summary.today;
  kWeek.innerText=d.summary.week;
  kMonth.innerText=d.summary.month;
  list.innerHTML=d.files.map(f=>`
  <tr>
    <td>${new Date(f.time).toLocaleString()}</td>
    <td class="${f.status==='DELETED'?'done':''}">${f.fileName}</td>
    <td>${f.status}</td>
    <td>${f.status==='ACTIVE'
      ?`<button onclick="open('${f.fileUrl}')">Download</button>
        <button onclick="done('${f.fileId}')">Done</button>`:'-'}</td>
  </tr>`).join("");
}
function open(u){window.open(u)}
async function done(id){
  await fetch(`${SCRIPT_URL}?action=done&fileId=${id}`);
  load();
}
load();
</script>

</body>
</html>
